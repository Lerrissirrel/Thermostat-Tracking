<script type='text/javascript'>


function displayCompareChartExec()
{
	var show_thermostat_id = 'id=' + document.getElementById( 'chart.compare.thermostat' ).value;

	// Browsers are very clever with image caching.	In this case it breaks the web page function.
	var no_cache_string = 'nocache=' + Math.random();

	var url_string = '';

	url_string = 'draw_compare.php';

	url_string = url_string + '?' + show_thermostat_id + '&' + no_cache_string;
	//console.log( url_string );

	document.getElementById( 'compare_chart' ).src = url_string;
}

function displayCompareChart()
{
	document.getElementById( 'compare_chart' ).src = 'images/need_default.png';	// Redraw the placekeeper while the chart is rendering
	// By using setTimeout we can separate the drawing of the placeholder image from the actual chart such that the browser will always draw the placeholder
	setTimeout(function(){ displayCompareChartExec();}, 500);
}

</script>

<?php
require_once( 'basic_tab.class' );

class Compare extends BasicTab
{
	public function __construct()
	{
		global $thermostats;

		parent::__construct();

		$this->setTab('');

		$this->addToTab( "<div class='tab' id='compare'> <a href='#compare'> Compare </a>" );
		$this->addToTab( "	<div class='container'>" );
		$this->addToTab( "		<div class='tab-toolbar'>" );
		$this->addToTab( "			<input type='button' onClick='javascript: displayCompareChart();' value='Show'>" );
		$this->addToTab( "			<select id='chart.compare.thermostat'>" );

		/** Let user pick which thermostat to show, but NEVER show more than one of them!
			*
			* If the user saved his choice last time in a cookie, use that one, otherwise default to first one
			*/
		foreach( $thermostats as $thermostatRec )
		{
			$this->addToTab( "<option " );
			if( $id == $thermostatRec['id'] )
			{
				$this->addToTab( "selected " );
			}
			$this->addToTab( "value='{$thermostatRec['id']}'>{$thermostatRec['name']}</option>" );
		}
		$this->addToTab( "			</select>" );

/** These two compare dates need to be dynamically populated based on the thermostat selected
	*
	* So the select of thermostat either onChange or onBlur needs to use Ajax to choose new values for first and second dates.
	* First date needs to go from 1 to n-1 and second date needs to go from 2 to n (where n is the max year in the record)
	* Disable first and second when there are not two years in the record and set both to the same year
	*
	*/
		$this->addToTab( "			Compare <select id='chart.compare.firstDate'><option value='2012'>2012</option><option value='2013'>2013</option><option value='2014'>2014</option></select>" );
		$this->addToTab( "			to <select id='chart.compare.secondDate'><option value='2012'>2012</option><option value='2013'>2013</option><option value='2014'>2014</option></select>" );

		$this->addToTab( "			for <select id='chart.compare.mode'><option value='0'>Heating</option><option value='1' selected>Cooling</option></select>" );

		$this->addToTab( "		</div>" );

		$this->addToTab( "		<div class='content'>" );
		$this->addToTab( "			<br>" );

		// Place chart area on tab
		$this->addToTab( "			<div class='thermo_chart'>" );
		$this->addToTab( "				<img id='compare_chart' src='img/need_default.png' alt='Year-over-year comparison graph' title='Year-over-year comparison'>" );
		$this->addToTab( "			</div>" );

		// Draw the chart
		$this->addToTab( "			<script type='text/javascript'>" );
		$this->addToTab( "				displayCompareChart();" );
		$this->addToTab( "			</script>" );

		$this->addToTab( "		</div>" );
		$this->addToTab( "	</div>" );
		$this->addToTab( "</div>" );

		$this->addToTab( "<div class='tab_gap'></div>" );
	}
}
?>