<script type='text/javascript'>

	// This .class file is not 100% self-cotained.  It presently requies JavaScript code form teh daily_tab.class

	// How to I make it both self-contianed AND have code reuse?

//Change names of the IDs to match this naming convention 'chart.history.toDate' instead of this convention 'history_to_date'
function display_historic_chart()
{
	var show_thermostat_id = 'id=' + document.getElementById( 'chart.history.thermostat' ).value;
	var show_indoor = 'Indoor=' + document.getElementById( 'history_selection' ).value;
	var show_hvac_runtime = 'show_hvac_runtime=' + document.getElementById( 'show_hvac_runtime' ).checked;

	var interval_measure_string = 'interval_measure=' + document.getElementById( 'interval_measure' ).value;
	var interval_length_string = 'interval_length=' + document.getElementById( 'interval_length' ).value;

	var history_to_date_string = 'history_to_date=' + document.getElementById( 'chart.history.toDate' ).value;

	var no_cache_string = 'nocache=' + Math.random(); // Browsers are very clever with image caching.	That cleverness breaks this web page's function.

	var url_string = 'draw_weekly.php?' + show_thermostat_id + '&' + show_indoor + '&' + show_hvac_runtime + '&' + interval_measure_string + '&' + interval_length_string + '&' + history_to_date_string	+ '&' + no_cache_string;
	console.log( url_string );
	document.getElementById( 'history_chart' ).src = url_string;
}


</script>

<?php
class History
{
	function __construct()
	{
		//echo 'hi!';
	}

	// How about making a generic Tab class and extending that to create specific tabs and setting properties to add things to the toolbar?
	function displayTab()
	{
		global $thermostats;
		global $show_date;
		$htmlString = '';

		$htmlString .= "<div class='tab' id='history'> <a href='#history'> History </a>";
		$htmlString .= "	<div class='container'>";
		$htmlString .= "		<div class='tab-toolbar'>";
		$htmlString .= "			<input type='button' onClick='javascript: display_historic_chart();' value='Show'>";
		$htmlString .= "			<select id='chart.history.thermostat'>";

		// Let user pick which thermostat to show, but always show ONLY (new feature - show multiple?) one of them!
		foreach( $thermostats as $thermostatRec )
		{
			$htmlString .= "<option ";
			if( isset($id) && $id == $thermostatRec['id'] )
			{
				$htmlString .= "selected ";
			}
			$htmlString .= "value='{$thermostatRec['id']}'>{$thermostatRec['name']}</option>";
		}
		$htmlString .= "			</select>";

		// Let user pick which temperature to show, but ALWAYS show at least one of them!
		$htmlString .= "			<select id='history_selection'>";
		$htmlString .= "				<option value='0' selected>Outoor</option>";
		$htmlString .= "				<option value='1'>Indoor</option>";
		$htmlString .= "				<option value='2'>Both</option>";
		$htmlString .= "			</select>";

		$htmlString .= "			Timeframe <input type='text' id='interval_length' value='21' size='3'>";
		$htmlString .= "			<select id='interval_measure' style='width: 65px'>";
		$htmlString .= "				<option value='0' selected>days</option>";
		$htmlString .= "				<option value='1'>weeks</option>";
		$htmlString .= "				<option value='2'>months</option>";
		$htmlString .= "			</select>";

		$htmlString .= "			ending on <input type='date' id='chart.history.toDate' size='10' value='{$show_date}' max='{$show_date}' step='1'/>";

		$htmlString .= "			&nbsp;&nbsp;Optionally show HVAC runtimes<input type='checkbox' id='show_hvac_runtime' name='show_hvac_runtime' onChange='javascript: toggle_daily_flag( \"show_hvac_runtime\" );'/>";
		$htmlString .= "			<input type='button' onClick='javascript: deleteCookies(1);' value='Un-save settings' style='float: right;'>";
		$htmlString .= "		</div>";

		$htmlString .= "		<div class='content'>";
		$htmlString .= "			<br>";
		$htmlString .= "			<div class='thermo_chart'>";
		$htmlString .= "				<img id='history_chart' src='img/need_default.png' alt='History Graph' title='History Graph'>";
		$htmlString .= "			</div>";

		// These initializations must fall AFTER the declaration of various HTML DOM variables
		// All of these preference values should be tested before use, don't let null (or un-set) mess up the values.
		// Preently preferences are stored in cookies.
		$htmlString .= "<script type='text/javascript'>";

		// In JavaScript, a literal/string value of "false" is a string of non zero length and so it tests as logically true unless you look for the literal string "true"

		// Restore user preference/cookie for showing/hiding hvac runtime
		$htmlString .= "if( getCookie('show_hvac_runtime') == 'true' )";
		$htmlString .= "{";
		$htmlString .= "	document.getElementById('show_hvac_runtime').checked = true;";
		$htmlString .= "}";

		// Draw the chart
		$htmlString .= "				display_historic_chart();";
		$htmlString .= "			</script>";
		$htmlString .= "		</div>";
		$htmlString .= "	</div>";
		$htmlString .= "</div>";
		$htmlString .= "<div class='tab_gap'></div>";


		echo $htmlString;


	}
}
?>